<html>

<head>
    <title>----'s Contact Manager</title>         <!--display users name where ---- -->
</head>
<style>
    body {
        display: flex;
        justify-content: center;
        align-items: center;    
        height: 100vh;           
        font-family: Playfair Display, sans-serif;
        background-color: #27f5e4;
		background-image: url('');			
		background-size: cover;
		background-position: center;
    }

    .contact-container {
        text-align: center;
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    input {
        display: block;
        width: 250px;
        margin: 10px auto;
        padding: 10px;
        border-radius: 4px;
        border: 1px solid #000000;
    }

    button {
        padding: 10px 20px;
        border-radius: 4px;
        border: none;
        background-color: #007bff;
        color: white;
        cursor: pointer;
    }

    button:hover {
        background-color: #0056b3;
    }

    .alertbutton{
        background-color: #ff0000;
    }

    .alertbutton:hover {
        background-color: #cc0000;
    }

    #color-container {
	    display:none;
	    margin-top: 20px;
    }

    #message {
	    color:red;
	    margin-top: 10px;
    }

	header {
		opacity: 0.6;
		
	}

    table {
        overflow-y:scroll;
        display:block;
        width: 10%;
        border-collapse: collapse;
    }

    th, td {
        padding: 12px 15px;
        border: 1px solid #ddd;
    }

    th {
        text-align: left;
        background-color: #f2f2f2;
    }

    .add-table-button{
        padding: 5px 10px;
        border-radius: 4px;
        border: none;
        background-color: #28a745;
        color: white;
        cursor: pointer;
        
    }

    .add-table-button:hover {
        background-color: #218838;
    }

    .edit-table-button{
        padding: 5px 10px;
        border-radius: 4px;
        border: none;
        background-color: #ff8e04;
        color: white;
        cursor: pointer;
        
    }

    .edit-table-button:hover {
        background-color: #e0a800;
    }

    .delete-table-button{
        padding: 5px 10px;
        border-radius: 4px;
        border: none;
        background-color: #dc3545;
        color: white;
        cursor: pointer;
        
    }
    .delete-table-button:hover {
        background-color: #c82333;
    }

</style>
<body>
    <div class ="contact-container">
	   <h2>Welcome ----!<br> </h2>           <!--display users name where ---- -->
       <h5>Enter a Name and Contact</h5><input type="text" id="name" placeholder="Name">
        <table>
            <tr>
                <th>Name</th>
                <th>Contact</th>
                <th>Action</th>
            </tr>
            <tr>
                <td> </td>
                <td> </td>
                <td><button class="add-table-button" onclick="addContact()">Add</button>
                <button class="edit-table-button" onclick="editContact()">Edit</button>
                <button class="delete-table-button" onclick="deleteContact()">Delete</button> </td>
            </tr>
        </table>
		<button class="alertbutton" onclick="signout()">Sign Out</button>


    </div>
    <script>
        let userId = "";
        function addContact() {
            const loginValue = document.getElementById("login").value;
            const passwordValue = document.getElementById("password").value;

            // Clear previous message
            document.getElementById("message").textContent = "";

            fetch("LAMPAPI/Login.php", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ login: loginValue, password: passwordValue })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error === "") {
                    // Login successful
                userId = data.userId;
                document.getElementById("message").textContent = "Added contact";
                    // Redirect to contact.html after a short delay
                    setTimeout(() => {
                        window.location.href = "contact.html";
                    }, 2000);
            } else {
                    // Login failed
                    document.getElementById("message").textContent = "Contact already exists. " + data.error;
                }
            })
            .catch(err => {
                console.error("Error:", err);
                document.getElementById("message").textContent = "Server error. Please try again.";
            });
        }

        function searchContact(){
            let srch = document.getElementById("searchText").value;
            document.getElementById("contactSearchResult").innerHTML = "";
            
            let contactList = "";

            let tmp = {search:srch,userId:userId};
            let jsonPayload = JSON.stringify( tmp );

            let url = urlBase + '/SearchContacts.' + extension;
            
            let xhr = new XMLHttpRequest();
            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-type", "application/json; charset=UTF-8");
            try
            {
                xhr.onreadystatechange = function() 
                {
                    if (this.readyState == 4 && this.status == 200) 
                    {
                        document.getElementById("contactSearchResult").innerHTML = "Contact(s) has been retrieved";
                        let jsonObject = JSON.parse( xhr.responseText );
                        
                        for( let i=0; i<jsonObject.results.length; i++ )
                        {
                            contactList += jsonObject.results[i];
                            if( i < jsonObject.results.length - 1 )
                            {
                                colorList += "<br />\r\n";
                            }
                        }
                        
                        document.getElementsByTagName("p")[0].innerHTML = contactList;
                    }
                    else{
                        document.getElementsByTagName("p")[0].innerHTML = "No contact of the description could be located. Please add the contact in."
                    }
                };
                xhr.send(jsonPayload);
            }
            catch(err)
            {
                document.getElementById("contactSearchResult").innerHTML = err.message;
            }
        }

        function editContact() {
            // Implement edit contact functionality
            // If there is issues with testing this one should be dropped for time sake to priortize working add, del, & search
        }

        function deleteContact() {
            document.getElementsById("contactSearchResult").innerHTML = "";

            let tmp = { id: contactId, userId: userId };
            let jsonPayload = JSON.stringify(tmp);

            let url = urlBase + '/DeleteContact.' + extension;

            let xhr = new XMLHttpRequest();
            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-type", "application/json;", "charset=UTF-8");

            try{
                xhr.onreadystatechange = function() {
                    if(this.readyState == 4 && this.status == 200){
                        document.getElementById("contactSearchResult").innerHTML = "Contact has been deleted.";
                    }
                };
                xhr.send(jsonPayload);
            }
            catch(err){
                document.getElementById("contactSearchResult").innerHTML = "Could not locate contact set for delete in the database. Contact was either not in the database or contact is misspelled."
            }
        }

        function signout() {
            window.location.href = "index.html";
        }

    </script>
</body>
</html>
