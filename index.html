<html>

<head>
    <title>Team 2's Contact Manager</title>
</head>
<style>
    body {
        display: flex;
        justify-content: center;
        align-items: center;    
        height: 100vh;           
        font-family: Playfair Display, sans-serif;
        background-color: #4bc3b9;
		background-image: url('');			
		background-size: cover;
		background-position: center;
    }

    .login-container {
        text-align: center;
        background: rgb(241, 240, 240);
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    input {
        display: block;
        width: 250px;
        margin: 10px auto;
        padding: 10px;
        border-radius: 4px;
        border: 1px solid #000000;
    }

    button {
        padding: 10px 20px;
        border-radius: 4px;
        border: none;
        background-color: #2837a7;
        color: white;
        cursor: pointer;
    }

    button:hover {
        background-color: #1f2b83;
    }

    #color-container {
	    display:none;
	    margin-top: 20px;
    }

    #message {
	    color:red;
	    margin-top: 10px;
    }

    #login-message{
        color:#000000;
        margin-top: 10px;
    }

	header {
		opacity: 0.6;
		
	}

</style>
<body>
    <div class ="login-container">
	   <h2>Welcome to Team's 2 Contact Manager <br> Please Login </h2> 
        <input type="text" id="login" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <button onclick="login()">Login</button>
        <div id="login-message"></div> 
        <div id="message"></div>
		<header><strong>Don't have an account?</strong></header>
		<button onclick="signup()">Sign Up</button>
     

    </div>

    <script>
	let userId = "";
function login() {
    const loginValue = document.getElementById("login").value;
    const passwordValue = document.getElementById("password").value;

    // Input validation
    if (!loginValue || !passwordValue) {
        document.getElementById("message").textContent = "Please enter both username and password";
        return;
    }

    document.getElementById("message").textContent = "";

    fetch("LAMPAPI/Login.php", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ 
            login: loginValue, 
            password: passwordValue 
        })
    })
    .then(response => {
        return response.text().then(text =>{
            console.log("Raw response from server:", text);
            try{
                return text ? JSON.parse(text) : {};
            }
            catch(e){
                console.error("Parse error:", text);
                throw new Error("Invalid JSON response");
            }
        });
    })
    .then(data => {
        console.log("Response data:", data); // Debug log
        if (data.error === "") {
            // Login successful
            userId = data.id;
            document.getElementById("login-message").textContent = 
                `Welcome ${data.firstName}, redirecting to contacts`;
            setTimeout(() => {
                window.location.href = "contact.html";
            }, 2000);
        } else {
            // Login failed
            const messageErr = document.getElementById("message");
            if(messageErr){
                messageErr.textContent = "Incorrect username or password. " + (data.error || "");
            }
            else{
                console.warn("Missing #message element in HTML.");
            }
        }
    })
    .catch(err => {
        console.error("Error details:", err);
        document.getElementById("message").textContent = 
            "Server error. Please try again. Details: " + err.message;
    });
}

function signup() {
	window.location.href = "signup.html";
}

</script>
</body>
</html>
